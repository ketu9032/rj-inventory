<div>
    <mat-spinner *ngIf="loader" class="loader" diameter="40"></mat-spinner>
    <div>
        <h1 class="center">Smart Purchase Target (SPT)</h1>
    </div>
    <div class="flex">
        <div>
            <!-- Categories start -->
            <mat-form-field class="field-width margin">
                <mat-label>All Categories </mat-label>
                <mat-select #select multiple class="select-width">
                    <div class="select-all">
                        <mat-checkbox color="primary" [(ngModel)]="allSelectedCategories"
                            [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCategories()">Select All
                        </mat-checkbox>
                    </div>
                    <mat-option (click)="optionClickCategories()" *ngFor="let category of categories"
                        [value]="category.id">
                        {{category.code | uppercase}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <!-- Suppliers start -->
            <mat-form-field class="field-width margin">
                <mat-label>All Suppliers </mat-label>
                <mat-select #select1 multiple>
                    <div class="select-all">
                        <mat-checkbox color="primary" [(ngModel)]="allSelectedSuppliers"
                            [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionBySuppliers()">Select All
                        </mat-checkbox>
                    </div>
                    <mat-option (click)="optionClickSuppliers()" *ngFor="let supplier of suppliers"
                        [value]="supplier.id">
                        {{supplier.company | uppercase}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <!-- items start -->
            <mat-form-field class="field-width margin">
                <mat-label>All Items </mat-label>
                <mat-select #select2 multiple>
                    <div class="select-all">
                        <mat-checkbox color="primary" [(ngModel)]="allSelectedItems"
                            [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByItems()">Select All
                        </mat-checkbox>
                    </div>
                    <mat-option (click)="optionClickItems()" *ngFor="let item of items" [value]="item.id">
                        {{item.item_code | uppercase}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <!-- 30 day start -->
            <mat-form-field class="field-width margin">
                <mat-label>30 days %</mat-label>
                <input matInput type="number" [(ngModel)]="thirtyDays" (keyup.enter)="getAnalysis()">
            </mat-form-field>
            <!-- 15 day start -->
            <mat-form-field class="field-width margin">
                <mat-label>15 days %</mat-label>
                <input matInput type="number" [(ngModel)]="fifteenDays" (keyup.enter)="getAnalysis()">
            </mat-form-field>
            <!-- 7 day start -->
            <mat-form-field class="field-width margin">
                <mat-label>7 days %</mat-label>
                <input matInput type="number" [(ngModel)]="sevenDays" (keyup.enter)="getAnalysis()">
            </mat-form-field>
            <!-- Future day start -->
            <mat-form-field class="field-width margin">
                <mat-label>Future days </mat-label>
                <input matInput type="number" [(ngModel)]="futureDays" (keyup.enter)="getAnalysis()">
            </mat-form-field>
            <!-- button start -->
            <button color="primary" class=" btn" mat-raised-button>
                Submit
            </button>
            <button color="primary" class="margin btn" mat-raised-button>
                Download
            </button>
        </div>
        <div>
            <!-- search start -->
            <mat-form-field class="field-width">
                <mat-label>Search...</mat-label>
                <input matInput type="text" [(ngModel)]="tableParams.search">
            </mat-form-field>
            <button color="primary" class="margin btn" mat-raised-button>
                Search
            </button>
        </div>
    </div>
    <br />
    <div class="mat-elevation-z8">
        <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)" matSortActive="company"
            matSortDirection="asc">
            <ng-container matColumnDef="item_code">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Code</th>
                <td mat-cell *matCellDef="let element">
                    {{ element.item_code}}
                </td>
            </ng-container>
            <ng-container matColumnDef="item_name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Item Name</th>
                <td mat-cell *matCellDef="let element">
                    {{ element.item_name }}
                </td>
            </ng-container>
            <ng-container matColumnDef="qty_30_days">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Last 30 Days</th>
                <td mat-cell *matCellDef="let element">
                    {{ !element.qty_30_days? 0 : element.qty_30_days }}
                </td>
            </ng-container>
            <ng-container matColumnDef="qty_15_days">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Last 15 Days </th>
                <td mat-cell *matCellDef="let element">
                    {{ !element.qty_15_days ? 0 : element.qty_15_days }}
                </td>
            </ng-container>
            <ng-container matColumnDef="qty_7_days">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Last 7 Days </th>
                <td mat-cell *matCellDef="let element">
                    {{ !element.qty_7_days ? 0 : element.qty_7_days }}
                </td>
            </ng-container>
            <ng-container matColumnDef="prediction_target">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Prediction/Target</th>
                <td mat-cell *matCellDef="let element">
                    {{ getPrediction(element.qty_30_days, element.qty_15_days, element.qty_7_days) | number: '1.0-0' }}
                </td>
            </ng-container>
            <ng-container matColumnDef="int_qty">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Actual Stock</th>
                <td mat-cell *matCellDef="let element">{{ !element.int_qty ? 0 : element.int_qty }}</td>
            </ng-container>
            <ng-container matColumnDef="required">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>% Required</th>
                <td mat-cell *matCellDef="let element">{{
                    getRequired(element.int_qty,element.qty_30_days, element.qty_15_days, element.qty_7_days) | number:
                    '1.0-0' }}%</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let element; columns: displayedColumns"></tr>
        </table>
        <mat-paginator #paginator [pageSizeOptions]="pageSizeOptions" [pageSize]="defaultPageSize" showFirstLastButtons
            (page)="pageChanged($event)" [length]="+totalRows" aria-label="Select page of elements">
        </mat-paginator>
    </div>
</div>
<!-- Profit  chart container start -->
<br>
<div class="flex">
    <div>
        <!-- Select date range -->
        <mat-form-field class="field-width margin">
            <mat-label>Select date range</mat-label>
            <mat-date-range-input [rangePicker]="picker">
                <input matStartDate [(ngModel)]="startDate" placeholder="Start date">
                <input matEndDate [(ngModel)]="endDate" placeholder="End date">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
        <!-- Categories start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Categories</mat-label>
            <mat-select #select multiple class="select-width">
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedCategories"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCategories()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickCategories()" *ngFor="let category of categories" [value]="category.id">
                    {{category.code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- Suppliers start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Suppliers</mat-label>
            <mat-select #select1 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedSuppliers"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionBySuppliers()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickSuppliers()" *ngFor="let supplier of suppliers" [value]="supplier.id">
                    {{supplier.company | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- items start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Items </mat-label>
            <mat-select #select2 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedItems" [ngModelOptions]="{standalone: true}"
                        (change)="toggleAllSelectionByItems()">Select All</mat-checkbox>
                </div>
                <mat-option (click)="optionClickItems()" *ngFor="let item of items" [value]="item.id">
                    {{item.item_code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- customers start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Customers </mat-label>
            <mat-select #select3 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedCustomers"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCustomers()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickCustomers()" *ngFor="let customer of customers" [value]="customer.id">
                    {{customer.company | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- button start -->
        <button color="primary" class=" btn" mat-raised-button (click)="getProfitChart()">
            Submit
        </button>
        <button color="primary" class="margin btn" mat-raised-button>
            Download
        </button>
    </div>
</div>
<!-- profit chart content -->
<div>
    <div class="header-content">
        <h1 class="center">Profit Chart</h1>
        <div class="center total-count">
             <span>Total Sale:<b> {{totalSaleInProfitChartWise}}</b>, </span>
            <span>Total Profit: <b> {{totalProfitInProfitChartWise}}</b> | </span>
            <span>Avg Sale:  <b> {{averageSaleInProfitChartWise | number: '1.0-0'}}</b>, </span>
            <span>Avg Profit:   <b> {{averageProfitInProfitChartWise | number: '1.0-0'}}</b> </span>
        </div>

        <div>
            <div id="profitChartData"></div>

        </div>
    </div>

</div>


<!-- Sale   chart container start -->
<br>
<div class="flex">
    <div>
        <!-- Select date range -->
        <mat-form-field class="field-width margin">
            <mat-label>Select date range</mat-label>
            <mat-date-range-input [rangePicker]="picker">
                <input matStartDate [(ngModel)]="fromDate" placeholder="Start date">
                <input matEndDate [(ngModel)]="toDate" placeholder="End date">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
        <!-- Categories start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Categories </mat-label>
            <mat-select #select multiple class="select-width">
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedCategories"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCategories()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickCategories()" *ngFor="let category of categories" [value]="category.id">
                    {{category.code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- Suppliers start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Suppliers </mat-label>
            <mat-select #select1 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedSuppliers"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionBySuppliers()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickSuppliers()" *ngFor="let supplier of suppliers" [value]="supplier.id">
                    {{supplier.company | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- items start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Items </mat-label>
            <mat-select #select2 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedItems" [ngModelOptions]="{standalone: true}"
                        (change)="toggleAllSelectionByItems()">Select All</mat-checkbox>
                </div>
                <mat-option (click)="optionClickItems()" *ngFor="let item of items" [value]="item.id">
                    {{item.item_code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- customers start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Customers </mat-label>
            <mat-select #select3 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedCustomers"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCustomers()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickCustomers()" *ngFor="let customer of customers" [value]="customer.id">
                    {{customer.company | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- button start -->
        <button color="primary" class=" btn" mat-raised-button (click)="getSaleChart()">
            Submit
        </button>
        <button color="primary" class="margin btn" mat-raised-button>
            Download
        </button>
    </div>

</div>
<!-- sale chart content -->
<div>
    <div class="header-content">
        <h1 class="center">Sale Chart</h1>
        <div class="center total-count">
            <span>Total Sale:<b> {{totalSaleInSaleChartWise}}</b>, </span>
            <span>Total Qty: <b> {{totalQtyInSaleChartWise}}</b> | </span>
            <span>Avg Sale:  <b> {{averageSaleInSaleChartWise | number: '1.0-0'}}</b>, </span>
            <span>Avg Qty:   <b> {{averageQtyInSaleChartWise | number: '1.0-0'}}</b> </span>
        </div>
    </div>
    <div>
        <div id="saleChartData"></div>
    </div>
</div>
<!-- Purchase   chart container start -->
<br>
<div class="flex">
    <div>
        <!-- Select date range -->
        <mat-form-field class="field-width margin">
            <mat-label>Select date range</mat-label>
            <mat-date-range-input [rangePicker]="picker">
                <input matStartDate [(ngModel)]="fromDate" placeholder="Start date">
                <input matEndDate [(ngModel)]="toDate" placeholder="End date">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
        <!-- Categories start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Categories</mat-label>
            <mat-select #select multiple class="select-width">
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedCategories"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionByCategories()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickCategories()" *ngFor="let category of categories" [value]="category.id">
                    {{category.code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- Suppliers start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Suppliers </mat-label>
            <mat-select #select1 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedSuppliers"
                        [ngModelOptions]="{standalone: true}" (change)="toggleAllSelectionBySuppliers()">Select All
                    </mat-checkbox>
                </div>
                <mat-option (click)="optionClickSuppliers()" *ngFor="let supplier of suppliers" [value]="supplier.id">
                    {{supplier.company | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- items start -->
        <mat-form-field class="field-width margin">
            <mat-label>All Items </mat-label>
            <mat-select #select2 multiple>
                <div class="select-all">
                    <mat-checkbox color="primary" [(ngModel)]="allSelectedItems" [ngModelOptions]="{standalone: true}"
                        (change)="toggleAllSelectionByItems()">Select All</mat-checkbox>
                </div>
                <mat-option (click)="optionClickItems()" *ngFor="let item of items" [value]="item.id">
                    {{item.item_code | uppercase}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <!-- button start -->
        <button color="primary" class=" btn" mat-raised-button (click)="getPurchaseChart()">
            Submit
        </button>
        <button color="primary" class="margin btn" mat-raised-button>
            Download
        </button>
    </div>

</div>
<!-- chart content -->
<div>
    <div class="header-content">
        <h1 class="center">Purchase Chart</h1>
        <div class="center total-count">

            <span>Total Purchase:<b> {{totalPurchaseInPurchaseChartWise}}</b>, </span>
            <span>Total Qty: <b> {{totalQtyInPurchaseChartWise}}</b> | </span>
            <span>Avg Purchase:  <b> {{averagePurchaseInPurchaseChartWise | number: '1.0-0'}}</b>, </span>
            <span>Avg Qty:   <b> {{averageQtyInPurchaseChartWise | number: '1.0-0'}}</b> </span>
        </div>
    </div>
    <div>
        <div id="purchaseChartData"></div>
    </div>
</div>
